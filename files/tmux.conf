#
# /etc/tmux.conf
#

#
#-------- Common Settings {{{
#------------------------------------------------------
#
# change prefix key to Ctrl-a; like GNU Screen
unbind-key C-b
set-option -g prefix C-a

# goto last used window
bind-key C-a last-window

# Nested Tmux Session
# send to tmux session within another tmux session; like screen
bind-key a send-prefix

# Lowers the delay time between the prefix key and other keys - fixes pausing in vim
set-option -sg escape-time 0

# reload config file
#bind-key r source-file /etc/tmux.conf \; display-message "Configuration reloaded"
#bind-key r source-file ~/.tmux.conf \; display-message "Configuration reloaded"

# history size
set-option -g history-limit 10000

# enable shell hotkeys C-left/C-right
set-window-option -g xterm-keys on

# enable 256 color terminal
#set-option -g default-terminal "screen-256color"
#set-option -g default-terminal "rxvt-unicode-256color"


#}}}
#-------- Keybinding (Vim Style) {{{
#------------------------------------------------------
#
# vim keys in command prompt
set-option -g status-keys vi

# unicode
set-window-option -g utf8 on

# select panes
bind-key k select-pane -U
bind-key h select-pane -L
bind-key j select-pane -D
bind-key l select-pane -R

# cycle windows/panes (no prefix)
bind-key -n M-k select-pane -t :.-	# prev pane
bind-key -n M-j select-pane -t :.+	# next pane
bind-key -n M-h select-window -t :-	# previous window
bind-key -n M-l select-window -t :+	# next window

# resize panes
#bind-key -r J resize-pane -D 1 
#bind-key -r K resize-pane -U 1 
#bind-key -r H resize-pane -L 1 
#bind-key -r L resize-pane -R 1
bind-key -r < resize-pane -L 3
bind-key -r > resize-pane -R 3
bind-key -r + resize-pane -U 1
bind-key -r = resize-pane -D 1

# better pane split bindings
bind-key - split-window -v
bind-key _ split-window -v
bind-key | split-window -h
 
# no confirmation when killing window/pane; by default is set to ask
bind-key q confirm-before kill-pane
bind-key Q confirm-before kill-window

# Sync panes - send what you're typing to other panes.
bind-key C-s set-window-option synchronize-panes


#}}}
#-------- Copy Mode (Vim Style) {{{
#------------------------------------------------------
# This section of hotkeys mainly work in copy mode and no where else
#
# vim keys in copy or choice mode
set-window-option -g mode-keys vi

# copying selection vim style
bind-key Escape copy-mode			# enter copy mode; default [
bind-key p paste-buffer				# paste; default ]
bind-key -t vi-copy v begin-selection		# begin visual mode
bind-key -t vi-copy V select-line		# visual line
bind-key -t vi-copy y copy-selection		# yank
bind-key -t vi-copy r rectangle-toggle 		# visual block toggle
bind-key -t vi-copy Escape cancel		# exit copy mode; or hit q

# clear scrollback buffer
# hit ctrl+l then ctrl+k
bind-key -n C-k clear-history


#}}}
#-------- Mouse {{{
#------------------------------------------------------
# mouse to highlight and copy; to paste use prefix + ]
# use shift + mouse to bypass to use system highlighting mode
#

set-option -g mode-mouse on
set-option -g mouse-resize-pane on
set-option -g mouse-select-pane on
set-option -g mouse-select-window on
  
# Toggle mouse on
bind-key m \
  set-option -g mode-mouse on \;\
  set-option -g mouse-resize-pane on \;\
  set-option -g mouse-select-pane on \;\
  set-option -g mouse-select-window on \;\
  display-message 'Mouse: ON'

# Toggle mouse off
bind-key M \
  set-option -g mode-mouse off \;\
  set-option -g mouse-resize-pane off \;\
  set-option -g mouse-select-pane off \;\
  set-option -g mouse-select-window off \;\
  display-message 'Mouse: OFF'

# mouse wheel scrolling -- whole window not individual panes
#set-option -g terminal-overrides 'xterm*:smcup@:rmcup@'


# }}}
#-------- Window / Pane Settings {{{
#------------------------------------------------------
#
# start window index on 1 instead of 0
set-option -g base-index 1

# start panes at 1 instead of 0
set-window-option -g pane-base-index 1

# pane divider color
set-option -g pane-border-fg colour166
set-option -g pane-border-bg colour16
set-option -g pane-active-border-fg colour166
set-option -g pane-active-border-bg colour16

# renumber windows sequentially after closing any of them
# https://github.com/thoughtbot/dotfiles/blob/master/tmux.conf
set-option -g renumber-windows on

# renumber windows manually
# https://github.com/jasoncodes/dotfiles/blob/master/config/tmux.conf
bind-key R set renumber-windows on\; new-window\; kill-window\; set renumber-windows off\; display 'Renumbered'

# set auto rename of windows base on command
#set-window-option -g automatic-rename on
# note: ohmyzsh users commet out DISABLE_AUTO_TITLE=true from zshrc to disable autorename
# http://superuser.com/questions/306028/tmux-and-zsh-custom-prompt-bug-with-window-name


#}}}
#-------- Statusbar {{{
#------------------------------------------------------
#
# UTF-8 character support in the status bar
set-option -g status-utf8 on

# refresh the status bar every 1 second.
set-option -g status-interval 1

# Time messages remain in the status bar. Lower this number
# if this is too distracting.
set-option -g display-time 4000

# command/message line colors
set-option -g message-bg colour235
set-option -g message-fg colour166
set-option -g message-attr bright

# window notifications; display activity on other window
set-window-option -g monitor-activity off
set-option -g visual-activity off

# statusbar colors
set-option -g status-bg colour235
set-option -g status-fg colour136
set-option -g status-attr default

# window title colors; non active
setw -g window-status-fg colour244
setw -g window-status-bg default
setw -g window-status-attr dim
 
# window title colors; active
setw -g window-status-current-fg colour166
setw -g window-status-current-bg default
setw -g window-status-current-attr underscore

# Left and right side of status bar
set-option -g status-justify centre
set-option -g status-left-length 40
set-option -g status-left "#[fg=green]Session: #S #[fg=yellow]#I #[fg=cyan]#P"
set-option -g status-right-length 140
set-option -g status-right '#[fg=red,dim,bg=default]#[fg=white,bg=default]%H:%M:%S#[default] #[fg=blue]%Y-%m-%d'



#}}}
#-------- External Scripts {{{
#------------------------------------------------------
#
# default shell
#set-option -g default-command /bin/zsh
#set-option -g default-shell /bin/zsh

# Run command on idle; screensaver
#set-option -g lock-after-time 10
#set-option -g lock-command "/usr/bin/cmatrix -C blue"


#}}}
#-------- Layout {{{
#------------------------------------------------------
#
# stats
bind-key M-s new-window -n stats -c $HOME \; \
	send-keys 'htop' 'Enter' \; \
	split-window -v -p 50 -t 1  \; \
	send-keys 'clear && figlet Freespace' 'Enter' \; \
	split-window -h -p 50 -t 1  \; \
	send-keys 't lsp | less' 'Enter' \; \
	split-window -h -p 50 -t 2  \; \
	send-keys 'df' 'Enter' \; \
	select-pane -t 2


#}}}
#-------- Others {{{
#------------------------------------------------------
#
# listen for activity on all windows
set -g bell-action any
#set -g bell-action none

# control automatic window renaming
setw -g automatic-rename off
 
# enable wm window titles
set -g set-titles on
 
# wm window title string (uses statusbar variables)
#set -g set-titles-string "tmux.#I.#W"
 
# don't close windows. just deactivate them. use respawn-window to reactivate.
#setw -g remain-on-exit on

# detach client
bind-key d detach
 
# choose a client to detach
bind-key D choose-client
 
# choose window/session
bind-key "'" choose-window
bind-key '"' choose-session
 
# display visible indicator of each pane
bind-key w display-panes

bind C-y run "tmux save-buffer - | xsel -b -i"

# http://www.andre-simon.de/doku/ansifilter/en/ansifilter.php
bind-key C-p pipe-pane -o 'ansifilter >>~/output.#I-#P'
 
# list all paste buffers (default key is '#')
bind-key b list-buffers
 
# choose buffer to paste interactively (default key was '=')
bind-key p choose-buffer
 
# delete the most recently copied buffer of text (default key was '-')
bind-key x delete-buffer

# new window
bind-key c new-window
 
# next
bind-key -r Space next-window
 
# prev
bind-key -r BSpace previous-window
 
# title (default key in tmux is ',')
bind-key A command-prompt "rename-window %%"
 
# quit
bind-key \ confirm-before kill-server
 
# displays
bind-key * list-clients
 
# redisplay (default key in tmux is 'r')
#bind-key C-l refresh-client
bind-key l refresh-client

# time for multiple commands (1s)
set -g repeat-time 1500

# toggle statusbar
bind-key s set status

# pane number display
set -g display-panes-active-colour colour33
set -g display-panes-colour colour166

# clock
setw -g clock-mode-colour colour166

# Session initialization
new -d -s logi -n logi "cat /dev/logi | ccze -m ansi -p syslog -C"
#splitw -t logi:1 -v -p 50 "cat /dev/fw | ccze -m ansi -p syslog -C"
selectw -t logi:1
selectp -t logi:1

new -d -s tmux -n cmd
splitw -t tmux:1 -v -p 50 newsbeuter
selectw -t tmux:1 
selectp -t tmux:1
